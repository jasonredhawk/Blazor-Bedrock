@inherits LayoutComponentBase
@using Blazor_Bedrock.Components.Shared
@using Blazor_Bedrock.Services.FeatureFlag
@using Microsoft.AspNetCore.Components.Authorization
@inject IFeatureFlagService FeatureFlagService
@inject Microsoft.JSInterop.IJSRuntime JSRuntime
@inject IConfiguration Configuration

<div class="d-flex flex-column" style="height: 100vh; overflow: hidden; --logger-height: var(--logger-height, 0px);">
    <TopMenuBar ProjectTitle="@_projectTitle" />

    <main class="flex-grow-1" style="overflow-y: auto; min-height: 0;">
        <div class="container-fluid mt-4">
            @Body
        </div>
    </main>

    <FeatureGate FeatureName="Logger_Enabled">
        <ApplicationLogger />
    </FeatureGate>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>
</div>

@code {
    private string _projectTitle = "Blazor Bedrock";

    protected override void OnInitialized()
    {
        // Read ProjectTitle from configuration, with fallback to default
        _projectTitle = Configuration["Application:ProjectTitle"] ?? "Blazor Bedrock";
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Check if logger is enabled and set CSS variable accordingly
            var isLoggerEnabled = await FeatureFlagService.IsEnabledAsync("Logger_Enabled");
            if (!isLoggerEnabled)
            {
                // Set height to 0 if feature is disabled
                await JSRuntime.InvokeVoidAsync("applicationLogger.setLoggerHeight", "0px");
            }
        }
    }
}
