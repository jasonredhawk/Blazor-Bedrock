@page "/profile"
@using Blazor_Bedrock.Data.Models
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using MudBlazor
@inject AuthenticationStateProvider AuthStateProvider
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Profile</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-4">My Profile</MudText>
    
    @if (_user != null)
    {
        <MudPaper Elevation="2" Class="pa-4">
            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.h6">Personal Information</MudText>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.body2" Class="font-weight-bold">First Name</MudText>
                    <MudText Typo="Typo.body1">@(_user.FirstName ?? "Not set")</MudText>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.body2" Class="font-weight-bold">Last Name</MudText>
                    <MudText Typo="Typo.body1">@(_user.LastName ?? "Not set")</MudText>
                </MudItem>
                <MudItem xs="12">
                    <MudText Typo="Typo.body2" Class="font-weight-bold">Email</MudText>
                    <MudText Typo="Typo.body1">@_user.Email</MudText>
                </MudItem>
                <MudItem xs="12">
                    <MudText Typo="Typo.body2" Class="font-weight-bold">Status</MudText>
                    <MudChip Size="Size.Small" 
                             Color="@(_user.IsActive ? Color.Success : Color.Error)" 
                             Variant="Variant.Filled"
                             T="string">
                        @(_user.IsActive ? "Active" : "Inactive")
                    </MudChip>
                </MudItem>
                <MudItem xs="12" Class="mt-4">
                    <MudButton Variant="Variant.Filled" 
                               Color="Color.Primary"
                               OnClick="NavigateToEdit">
                        Edit Profile
                    </MudButton>
                </MudItem>
            </MudGrid>
        </MudPaper>
    }
</MudContainer>

@code {
    private ApplicationUser? _user;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        if (authState.User?.Identity?.IsAuthenticated == true)
        {
            var userId = authState.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
            if (!string.IsNullOrEmpty(userId))
            {
                _user = await UserManager.FindByIdAsync(userId);
            }
        }
    }

    private void NavigateToEdit()
    {
        Navigation.NavigateTo("/profile/edit");
    }
}

